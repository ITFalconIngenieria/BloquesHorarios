
<div nz-row>
    <div nz-col [nzSpan]="24" class="min-margin">
        <h1 nz-typography class="center-in-col no-margin">Sistema de Facturacion Energetica</h1>
    </div>
</div>
    <div nz-row class="min-margin">
        <div nz-col [nzSpan]="6">
            <h3 nz-typography class="no-margin center-in-col">Bloques Horarios</h3>
        </div>
        <div nz-col [nzSpan]="6" class="center-in-col">
            <button nz-button nzType="primary" (click)="openFormularioMatrizHoraria()"
              style="background-color:seagreen;border-color: seagreen;"
            >
              <i nz-icon nzType="plus"></i>
              Nueva Matriz Horaria</button>
        </div>
        <div nz-col [nzSpan]="6">
            <button nz-button nzType="danger" [nzLoading]="loadingDeleteMatrizHoraria" [disabled]="!selectMatrizHorariaIndex" (click)="openDeleteConfirmDialog()">
              <i nz-icon nzType="delete" nzTheme="outline"></i>
            Eliminar Matriz Horaria
            </button>
        </div>
        <div nz-col [nzSpan]="6" class="center-in-col">
            <nz-select [(ngModel)]="MatrizHorariaKey" [nzDisabled]="loadingSelectData" [nzLoading]="loadingSelectData" (ngModelChange)="handleChangeMatrizHorariaSelect()">
              <nz-option *ngFor="let matriz of MatrizHorariaData" [nzValue]="matriz.id" [nzLabel]="matriz.codigo"></nz-option>
            </nz-select>
        </div>
    </div>
    <div nz-row class="min-margin">
      <div nz-col [nzSpan]="16" [nzPush]="4">
        <form nz-form [formGroup]="viewMatrizHoraria">
          <div nz-row nzGutter="8">
            <div nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-label>Descripcion</nz-form-label>
                <nz-form-control>
                  <nz-input-group>
                    <textarea nz-input formControlName="Descripcion" nzAutosize (keyup)="handleModifyTextArea($event)"></textarea>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-label>Observacion</nz-form-label>
                <nz-form-control>
                  <nz-input-group>
                    <textarea nz-input formControlName="Observacion" nzAutosize (keyup)="handleModifyTextArea($event)"></textarea>
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </form>
      </div>
    </div>
<div nz-row nzType="flex" nzJustify="center" nzAlign="middle" class="min-margin">
    <div nz-col [nzSpan]="18">
        <nz-table [nzData]="['']" nzBordered [nzLoading]="loadingTableData">
            <thead class="bold-text">
                <tr>
                    <th rowspan="2" [nzAlign]="'center'">Clase Dia</th>
                    <th colspan="2" [nzAlign]="'center'">Periodo de Punta</th>
                    <th colspan="2" [nzAlign]="'center'">Periodo de Intermedio</th>
                    <th colspan="2" [nzAlign]="'center'">Periodo de Valle</th>
                </tr>
                <tr>
                    <th [nzAlign]="'center'">Total Horas</th>
                    <th [nzAlign]="'center'">Horarios</th>
                    <th [nzAlign]="'center'">Total Horas</th>
                    <th [nzAlign]="'center'">Horarios</th>
                    <th [nzAlign]="'center'">Total Horas</th>
                    <th [nzAlign]="'center'">Horarios</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of TableDataView; index as i;">
                    <td [nzAlign]="'center'">{{ data.ClaseDia }}</td>
                    <td [nzAlign]="'center'">{{ data.Tiempo.TotalHoras[0] }}</td>
                    <td [nzAlign]="'center'">
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,0,0,data.IdBloques[0])"
                      (click)="openHorarioModal()"
                      ><i class="add-button" nz-icon nzType="plus"></i></button>
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,0,0,data.IdBloques[0])"
                      (click)="openModalDeleteHorarios()"
                      ><i class="delete-button" nz-icon nzType="delete" nzTheme="outline"></i></button>
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,0,0,data.IdBloques[0])"
                      (click)="openModifyHorarioModal()"
                      ><i nz-icon nzType="edit" nzTheme="outline"></i></button>
                      <pre>{{ data.Tiempo.HorarioString[0] }}</pre>
                    </td>
                    <td [nzAlign]="'center'">{{ data.Tiempo.TotalHoras[1] }}</td>
                    <td [nzAlign]="'center'">
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,1,1,data.IdBloques[1])"
                      (click)="openHorarioModal()"
                      ><i class="add-button" nz-icon nzType="plus"></i></button>
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,1,1,data.IdBloques[1])"
                      (click)="openModalDeleteHorarios()"
                      ><i class="delete-button" nz-icon nzType="delete" nzTheme="outline"></i></button>
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,1,1,data.IdBloques[1])"
                      (click)="openModifyHorarioModal()"
                      ><i nz-icon nzType="edit" nzTheme="outline"></i></button>
                      <pre>{{ data.Tiempo.HorarioString[1] }}</pre>
                    </td>
                    <td [nzAlign]="'center'">{{ data.Tiempo.TotalHoras[2] }}</td>
                    <td [nzAlign]="'center'">
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,2,2,data.IdBloques[2])"
                      (click)="openHorarioModal()"
                      ><i class="add-button" nz-icon nzType="plus"></i></button>
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,2,2,data.IdBloques[2])"
                      (click)="openModalDeleteHorarios()"
                      ><i class="delete-button" nz-icon nzType="delete" nzTheme="outline"></i></button>
                      <button nz-button nzType="link"
                      (click)="handleSaveDataInVariables(i,2,2,data.IdBloques[2])"
                      (click)="openModifyHorarioModal()"
                      ><i nz-icon nzType="edit" nzTheme="outline"></i></button>
                      <pre>{{ data.Tiempo.HorarioString[2] }}</pre>
                    </td>
                </tr>
            </tbody>
        </nz-table>
    </div>
</div>
<nz-drawer
    [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzMaskClosable]="false"
    [nzWidth]="720"
    [nzVisible]="visibleMatrizHorariaForm"
    nzTitle="Nueva Matriz Horaria"
    (nzOnClose)="handleCloseMatrizHorariaForm()"
>
<form nz-form [formGroup]="matrizHorariaForm">
    <div nz-row nzGutter="8">
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label>Codigo</nz-form-label>
          <nz-form-control>
            <input nz-input placeholder="Ingrese Codigo de la Matriz" formControlName="Codigo"/>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-label>Descripcion</nz-form-label>
          <nz-form-control>
            <nz-input-group>
              <input type="text" nz-input placeholder="De una Descripcion" formControlName="Descripcion"/>
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row nzGutter="8">
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-label>Observacion</nz-form-label>
          <nz-form-control>
            <textarea
              nz-input
              placeholder="Escriba alguna Observacion"
              [nzAutosize]="{ minRows: 4, maxRows: 4 }"
              formControlName="Observacion"
            ></textarea>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
  <div class="footer">
    <button nz-button nzType="danger" (click)="handleCloseMatrizHorariaForm()"  style="margin-right: 8px;"><span>Cancel</span></button>
    <button nz-button nzType="primary" *ngIf="matrizHorariaForm.valid" (click)="handleOkMatrizHorariaForm()" style="background-color:seagreen;border-color: seagreen;" [nzLoading]="loadingPostMatrizHoraria"><span>Submit</span></button>
  </div>
</nz-drawer>

<div>
  <nz-modal
    [(nzVisible)]="visibleHorariosDeleteModal"
    nzTitle="Eliminar Horarios"
    [nzFooter]="modalDeleteFooter"
    [nzContent]="modalDeleteContent"
    (nzOnCancel)="handleCancelDeleteHorarios()"
  >

  <ng-template #modalDeleteContent>
    <form nz-form>
      <div nz-row>
        <div nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label>Horario</nz-form-label>
              <nz-select nzMode="tags" [(ngModel)]="SelectTags" [ngModelOptions]="{standalone: true}" nzAllowClear>
                <nz-option *ngFor="let option of SelectDeleteHorarioView" [nzLabel]="option.Horario" [nzValue]="option.Id"></nz-option>
              </nz-select>
          </nz-form-item>
        </div>
      </div>
    </form>
  </ng-template>

  <ng-template #modalDeleteFooter>
    <button nz-button nzType="danger"  (click)="handleCancelDeleteHorarios()"  style="margin-right: 8px;"><span>Cancel</span></button>
    <button nz-button nzType="primary" *ngIf="SelectTags.length" (click)="handleOkDeleteHorarios()" style="background-color:seagreen;border-color: seagreen;" [nzLoading]="loadingDeleteHorario"><span>Submit</span></button>
  </ng-template>

  </nz-modal>
  <nz-modal
    [(nzVisible)]="visibleHorariosModal"
    nzTitle="Agregar Horario"
    (nzOnCancel)="handleCancelModalHorarios()"
  >
  <div>
    <form nz-form>
      <div nz-row nzGutter="8">
        <div nz-col nzSpan="12">
          <nz-form-item>
            <nz-form-label>Hora Inicial</nz-form-label>
              <nz-select [(ngModel)]="InitialTime"  [ngModelOptions]="{standalone: true}" nzAllowClear>
                <nz-option
                *ngFor="let Hours of HoursList"
                [nzLabel]="Hours.Tag"
                [nzValue]="Hours.Hour"
                [nzDisabled]="handleDisableOption(Hours.Hour)"
                >
                </nz-option>
              </nz-select>
          </nz-form-item>
        </div>
      </div>
      <div nz-row nzGutter="8">
        <div nz-col nzSpan="12">
          <nz-form-item>
            <nz-form-label>Hora Final</nz-form-label>
            <nz-select [(ngModel)]="FinalTime" [ngModelOptions]="{standalone: true}" nzAllowClear>
              <nz-option
              *ngFor="let Hours of HoursList"
              [nzLabel]="Hours.Tag"
              [nzValue]="Hours.Hour"
              [nzDisabled]="handleDisableOption(Hours.Hour)"
              >
              </nz-option>
            </nz-select>
          </nz-form-item>
        </div>
      </div>
    </form>
  </div>
  <div *nzModalFooter>
    <button nz-button nzType="danger"  (click)="handleCancelModalHorarios()" style="margin-right: 8px;"><span>Cancel</span></button>
    <button nz-button nzType="primary" *ngIf="InitialTime !== null && FinalTime !== null" (click)="handleOkModalHorarios()" style="background-color:seagreen;border-color: seagreen;" [nzLoading]="loadingPostingHorario"><span>Submit</span></button>
  </div>
  </nz-modal>
  
  <nz-modal
    [(nzVisible)]="visibleModifyHorarioModal"
    (nzOnCancel)="handleCancelModifyHorario()"
    nzTitle="Modificar Horarios"
    [nzContent]="modalModifyContent"
    [nzFooter]="modalModifyFooter"
  >
    <ng-template #modalModifyContent>

      <div nz-row>
        <div nz-col nzSpan="24">
            <h5>Horario</h5>
              <nz-select [(ngModel)]="selectedHorarioModifyId" nzAllowClear>
                <nz-option *ngFor="let option of SelectModifyHorarioView" [nzLabel]="option.Horario" [nzValue]="option.Id"></nz-option>
              </nz-select>
        </div>
      </div>
      <div nz-row style="margin-top: 10px;">
        <div nz-col nzSpan="24">
          <h5>Hora Inicial</h5>
          <nz-select [(ngModel)]="InitialTime" [nzDisabled]="!selectedHorarioModifyId" nzAllowClear>
            <nz-option
            *ngFor="let Hours of HoursList"
            [nzLabel]="Hours.Tag"
            [nzValue]="Hours.Hour"
            [nzDisabled]="handleDisableOption(Hours.Hour)"
            >
          </nz-option>
          </nz-select>
        </div>
      </div>
      <div nz-row style="margin-top: 10px;">
        <div nz-col nzSpan="24">
          <h5>Hora Final</h5>
          <nz-select [(ngModel)]="FinalTime" [nzDisabled]="!selectedHorarioModifyId" nzAllowClear>
            <nz-option
            *ngFor="let Hours of HoursList"
            [nzLabel]="Hours.Tag"
            [nzValue]="Hours.Hour"
            [nzDisabled]="handleDisableOption(Hours.Hour)"
            >
            </nz-option>
          </nz-select>
        </div>
      </div>
    </ng-template>

    <ng-template #modalModifyFooter>
      <button nz-button nzType="danger"  (click)="handleCancelModifyHorario()"  style="margin-right: 8px;"><span>Cancel</span></button>
      <button nz-button nzType="primary" *ngIf="InitialTime && FinalTime && selectedHorarioModifyId" (click)="handleOkModifyHorario()" style="background-color:seagreen;border-color: seagreen;" [nzLoading]="loadingDeleteHorario"><span>Submit</span></button>
    </ng-template>
  </nz-modal>
</div>